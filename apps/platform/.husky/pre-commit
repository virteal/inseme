#!/bin/sh
# Husky pre-commit hook: run lint-staged if available, otherwise skip gracefully.
# This avoids interactive npx prompts in the GitHub Desktop Windows UI and allows users
# without Node/npm on PATH to commit without failing the hook.

# Exit with success if hook is run in a context where Node or npm are not available,
# or if lint-staged is not installed locally.

# Check for node and npm in PATH
if ! command -v node >/dev/null 2>&1 || ! command -v npm >/dev/null 2>&1; then
  echo "Warning: 'node' or 'npm' not found in PATH. Skipping lint-staged (pre-commit checks)."
  exit 0
fi

# If node_modules/.bin/lint-staged exists, run it via npm script (preferred)
if [ -x "./node_modules/.bin/lint-staged" ]; then
  npm run -s lint-staged
  exit $?
fi

# If lint-staged isn't installed locally, warn and skip rather than attempt interactive install
if ! npm list --depth=0 lint-staged >/dev/null 2>&1; then
  echo "Warning: 'lint-staged' not installed locally in node_modules. Run 'npm ci' or 'npm install' to enable pre-commit checks. Skipping hook."
  exit 0
fi

# As a fallback, run npm script (this will error if lint-staged fails checks)
npm run -s lint-staged

