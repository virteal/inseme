<!doctype html>

<html lang="fr">
<head>
  <meta charset="utf-8">

  <title>Inseme</title>
  <link rel="icon" href="http://virteal.com/yanugred16.png" type="image/png">

  <meta name="description" content="Votes pour assemblées, façon NuitDebout & #liquiddemocracy">
  <meta name="author" content="@jhr">
  
  <meta property="og:url"           content="http://inseme.kudocracy.com" />
	<meta property="og:type"          content="website" />
	<meta property="og:title"         content="Inseme" />
	<meta property="og:description"   content="Se former et participer aux assemblées #nuitdebout. #DemocratieDirect #kudocracy via @kudocracy" />

  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet" href="style.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
  <!-- jQuery -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
  
  <!-- Embedly -->
  <script src="https://cdn.embed.ly/jquery.embedly-3.1.2.min.js" type="text/javascript"></script>
  
  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

  <!-- Firebase -->
  <script src='https://cdn.firebase.com/js/client/2.0.2/firebase.js'></script>
  
  <!-- Firechat -->
  <link rel='stylesheet' href='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.css' />
  <script src='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.js'></script>
  
  <script src="inseme.js"></script>
  
</head>

<body class="grey-text text-darken-4">
  
  <!-- Load Facebook SDK for JavaScript -->
	<div id="fb-root"></div>
	<script>
	window.fbAsyncInit = function() {
    FB.init({
      appId      : '1765572157008965',
      xfbml      : true,
      version    : 'v2.6'
    });
  };
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
	</script>

    <script type='text/javascript'>
  
    var chatRef;

    function login( provider ){
      chatRef.authWithOAuthPopup( provider, function( error, authData ){
        if( error ){
          console.log( error );
        }
      });
    }
  
    $(document).ready( function(){
      
      // I use embedly for the content display at the bottom of the page
      $.embedly.defaults.key = '4b04162cd6134d0da674a15aa65b8c4b';
      
      // Create a new Firebase reference, and a new instance of the Login client
      chatRef = new Firebase('https://inseme.firebaseio.com/chat');
      Inseme.chatRef = chatRef;
      
      // Once authenticated, instantiate Firechat with our user id and user name
      chatRef.onAuth( function( authData ){
        $('#inseme_live_container').removeClass( "hide" );
        if( !authData )return;
        $('#inseme_logout').removeClass( "hide" ).click( function(){
          Inseme.logout();
          chatRef.unauth();
          document.location.reload();
        });
        Inseme.patch_firechat();
        var chat = new FirechatUI( 
          chatRef, 
          document.getElementById( 'firechat-wrapper') 
        );
        Inseme.init( { firechat: chat } );
        Inseme.populate_vote_buttons();
        var uid = authData.uid;
        var info = authData[authData.provider]
        var name = info.username || info.displayName;
        if( authData.provider === "twitter" ){
          name = "@" + name;
        }
        var room = window.location.search;
        // Get rid of ? if some room was specified
        if( room.length ){
          room = room.substring( 1 );
        }
        chat.setUser( uid, name );
        // Hack: because FirechatUI's .setUser() does not allow a callback,
        // I need to use a timeout...
        // ToDo: monkey patch firechat API to set up a callback
        setTimeout( 
          function(){
            Inseme.login( uid, name, room );
            setTimeout( 
              function(){
                Inseme.display_short_results();
                Inseme.display_long_results();
              },
              3000 // Enought time to process previous 'inseme' messages
            );
          },
          3000 // Enought time to reload previous chat messages
        );
      } );
    } );
    
    </script>
    
    <div id="iseme_logo" class="container center"><img src="nuitdebout.png"></div>
    
    <div id="inseme_live_container" class="container center hide">
      <!--
      <iframe id="inseme_live_frame" src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Flenouvelobservateur%2Fvideos%2Fvb.198508090036%2F10156868107940037%2F%3Ftype%3D3&show_text=0&width=400" width="400" height="400" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
      -->
      <iframe id="inseme_live_frame" src="https://embed.bambuser.com/channel/nuitdebout" width="100%" height="600" frameborder="0"></iframe>
       
    </div>
    
    <div id='firechat-wrapper' class="container center">
      <div id="inseme_title">
        <h5>Inseme</h5>version alpha 0.7 du 22 avril 2016
      </div>
      <div>
        <a href='#' onclick='login("twitter");'>
          <img src="https://g.twimg.com/dev/sites/default/files/images_documentation/sign-in-with-twitter-gray.png"/> 
        </a>
      </div>
      <div>
        ou
        <a href='#' onclick='login("facebook");'>
          Facebook
        </a>
        <a href='#' onclick='login("github");'>
          Github
        </a>
      </div>
      <div id="inseme_slogan"><h4>Apprenez la gestuelle Nuit Debout et participez à distance aux assemblées</h4></div>
      <div>
        <iframe width="100%" height="600" src="https://www.youtube.com/embed/04Z6X4iaZrc" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
    
    <div id='inseme_actions' class="container">
      <div id="inseme_vote_buttons"></div>
      <a id="inseme_logout" class="waves-effect waves-light btn hide">D&eacute;connexion</a>
    </div>
    
    <div id='inseme' class="container hide">
      <div id="inseme_inseme" class="card-panel">
        <div class="card-content">
          <div>
            <span>Proposition : </span>
            <span id="inseme_proposition_text">
              Envoyez 'inseme ? le texte de votre proposition'
            </span>
          </div>
          <div>
            <span id="inseme_proposition_results"></span>
          </div>
          <div id="inseme_you">
            <span id="inseme_proposition_vote"></span>
            <span id="inseme_countdown" class="hide text-darken-2"></span>
          </div>
          <br>
          <div id="inseme_vote_list"></div>
        </div>
    </div>
    
    <div id='inseme_image_container' class="container center">
      <img src="nuitdebout.png">
      </a>
      <script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
    </div>
    
    <div id="inseme_twitter_timeline" class="container hide">
      <a class="twitter-timeline" href="https://twitter.com/ReportersDebout">Tweets de @ReportersDebout</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    
    <footer class="page-footer blue lighten-4">
    <div class="container"><div class="row">
    Inseme
    - <a href="http://documentup.com/Virteal/inseme">&agrave; propos</a>
    - <a href="/pad">pad</a>
    - <a href="http://nuitdebout.fr">nuitdebout.fr</a>
    - 
    
    <div id="inseme_social_buttons">
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://inseme.kudocracy.com" data-text="#inseme. Se former et participer aux assemblées #nuitdebout. #DemocratieDirecte #kudocracy" data-via="kudocracy" data-lang="fr" data-dnt="true">Partage</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <div class="fb-share-button" 
		  data-href="http://inseme.kudocracy.com" 
		  data-layout="button_count">
	  </div>

   	</div>
   	<div>
   	  <br>
   	</div>
   	
</body>
</html>
