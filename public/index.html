<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Inseme</title>

  <meta name="description" content="Votes pour assemblées, façon NuitDebout">
  <meta name="author" content="@jhr">
  
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet" href="style.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
  <!-- jQuery -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script>

  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

  <!-- Firebase -->
  <script src='https://cdn.firebase.com/js/client/2.0.2/firebase.js'></script>
  <!-- Firechat -->
  <link rel='stylesheet' href='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.css' />
  <script src='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.js'></script>
  
  <script src="inseme.js"></script>
  
</head>

<body class="grey-text text-darken-4">

 <script type='text/javascript'>
      // Create a new Firebase reference, and a new instance of the Login client
      var chatRef = new Firebase('https://inseme.firebaseio.com/chat');
      chatRef.onAuth(function(authData) {
        // Once authenticated, instantiate Firechat with our user id and user name
        if (authData) {
          var chat = new FirechatUI(chatRef, document.getElementById('firechat-wrapper'));
          Inseme.init( { firechat: chat } );
          chat.setUser(
            authData.uid, 
            authData[authData.provider].displayName
          );
          setTimeout( 
            function(){
              Inseme.login( authData.uid, authData[authData.provider].displayName );
              $vote_buttons = $("#vote_buttons");
              Inseme.each_choice( function( c ){
                var text = Inseme.config.choices[ c ].text;
                if( !text )return;
                // Add a button to vote according to that choice
                var $input = $(
                  '<input type="button" class="inseme_vote" value="' + text
                + '" data-inseme-vote="' + c
                + '" />'
                );
                $input.appendTo( $vote_buttons );
              });
              // Add handler to manage each button
              $(".inseme_vote").click ( function() {
                var vote = $(this).attr ( "data-inseme-vote" );
                Inseme.change_vote( vote );
              } );
            },
            5000
          );
        };
      });
      function login(provider) {
        chatRef.authWithOAuthPopup(provider, function(error, authData) {
          if (error) {
            console.log(error);
          }
        });
      }
    </script>
    
    <div class="container center">
      <h2>Inseme</h2>
    </div>
    
    <div class="container center">
      <iframe src="https://embed.bambuser.com/channel/nuitdebout" width="460" height="345" frameborder="0"></iframe>
    </div>
    
    <div id='firechat-wrapper' class="container">
      <a href='#' onclick='login("twitter");'>Connexion <img src="https://g.twimg.com/dev/sites/default/files/images_documentation/sign-in-with-twitter-gray.png"/></a>
    </div>
    
    <div id='inseme' class="container">
      
    </div>
    
    <div id='help' class="container">
      <div id="vote_buttons"></div>
      <img src="https://pbs.twimg.com/media/CfJGLWBXEAEPBfC.jpg"/>
    </div>
    
    <footer class="page-footer blue lighten-4"><div class="container">
    <a href="https://github.com/virteal/inseme">A propos</a>
    - <a href="/pad">Pad</a>
    - <a href="http://nuitdebout.fr">nuitdebout.fr</a>
    </div></footer>
    
</body>
</html>
