<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Inseme</title>
  <link rel="icon" href="http://virteal.com/yanugred16.png" type="image/png">

  <meta name="description" content="Votes pour assemblées, façon NuitDebout & #liquiddemocracy">
  <meta name="author" content="@jhr">
  
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet" href="style.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
  <!-- jQuery -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
  
  <!-- Embedly -->
  <script src="https://cdn.embed.ly/jquery.embedly-3.1.2.min.js" type="text/javascript"></script>
  
  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

  <!-- Firebase -->
  <script src='https://cdn.firebase.com/js/client/2.0.2/firebase.js'></script>
  
  <!-- Firechat -->
  <link rel='stylesheet' href='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.css' />
  <script src='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.js'></script>
  
  <script src="inseme.js"></script>
  
</head>

<body class="grey-text text-darken-4">
  
  <!-- Load Facebook SDK for JavaScript -->
	<div id="fb-root"></div>
	<script>
	window.fbAsyncInit = function() {
    FB.init({
      appId      : '1765572157008965',
      xfbml      : true,
      version    : 'v2.6'
    });
  };
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
	</script>

    <script type='text/javascript'>
  
    var chatRef;

    function login( provider ){
      chatRef.authWithOAuthPopup( provider, function( error, authData ){
        if( error ){
          console.log( error );
        }
      });
    }
  
    $(document).ready( function(){
      
      // I use embedly for the content display at the bottom of the page
      $.embedly.defaults.key = '4b04162cd6134d0da674a15aa65b8c4b';
      
      // Create a new Firebase reference, and a new instance of the Login client
      chatRef = new Firebase('https://inseme.firebaseio.com/chat');
      Inseme.chatRef = chatRef;
      
      // Once authenticated, instantiate Firechat with our user id and user name
      chatRef.onAuth( function( authData ){
        $('#inseme_live_container').removeClass( "hide" );
        if( !authData )return;
        var chat = new FirechatUI( 
          chatRef, 
          document.getElementById( 'firechat-wrapper') 
        );
        Inseme.init( { firechat: chat } );
        var uid = authData.uid;
        var name = authData[authData.provider].username;
        chat.setUser( uid, name );
        setTimeout( 
          function(){
            Inseme.populate_vote_buttons();
            Inseme.login( uid, name );
            setTimeout( 
              function(){
                Inseme.display_short_results();
                Inseme.display_long_results();
              },
              3000 // Enought time to process previous 'inseme' messages
            );
          },
          3000 // Enought time to reload previous chat messages
        );
      } );
    } );
    
    </script>
    
    <div id="inseme_live_container" class="container center hide">
      <!--
      <iframe id="inseme_live_frame" src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Flenouvelobservateur%2Fvideos%2Fvb.198508090036%2F10156868107940037%2F%3Ftype%3D3&show_text=0&width=400" width="400" height="400" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
      -->
      <iframe id="inseme_live_frame" src="https://embed.bambuser.com/channel/nuitdebout" width="460" height="345" frameborder="0"></iframe>
       
    </div>
    
    <div id='firechat-wrapper' class="container center">
      <div id="inseme_title">Inseme, alpha 0.2, 14 avril 2016</div>
      <div>
        <a href='#' onclick='login("twitter");'>
          <img src="https://g.twimg.com/dev/sites/default/files/images_documentation/sign-in-with-twitter-gray.png"/> 
        </a>
      </div>
      <div>
        <iframe width="600" height="350" src="https://www.youtube.com/embed/04Z6X4iaZrc" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
    
    <div id='inseme' class="container hide">
      <span>Proposition : </span><span id="inseme_proposition_text">
        Envoyez 'inseme ? le texte de votre proposition'
      </span>
      <div id="inseme_you">
        Vous : <span id="inseme_proposition_vote"></span>
        <span id="inseme_countdown" class="hide"></span>
      </div>
      <div id="inseme_inseme">
        Ensemble : <span id="inseme_proposition_results"></span>
      </div>
    </div>
    
    <div id='inseme_actions'>
      <div id="inseme_vote_buttons" class="container"></div>
    </div>
    
    <div id='inseme_image_container' class="container">
      <a href="https://pbs.twimg.com/media/CfJGLWBXEAEPBfC.jpg">
      <img src="https://pbs.twimg.com/media/CfJGLWBXEAEPBfC.jpg">
      </a>
      <script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
    </div>
    
    <div id="inseme_vote_list" class="container"></div>
    
    <footer class="page-footer blue lighten-4">
    <div class="container"><div class="row">
    Inseme
    - <a href="https://github.com/virteal/inseme">&agrave; propos</a>
    - <a href="/pad">pad</a>
    - <a href="http://nuitdebout.fr">nuitdebout.fr</a>
    </div></div>
    </footer>
    
</body>
</html>
