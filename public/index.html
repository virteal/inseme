<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Inseme</title>
  <link rel="icon" href="http://virteal.com/yanugred16.png" type="image/png">

  <meta name="description" content="Votes pour assemblées, façon NuitDebout">
  <meta name="author" content="@jhr">
  
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet" href="style.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
  <!-- jQuery -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js'></script>
  
  <!-- Embedly -->
  <script src="https://cdn.embed.ly/jquery.embedly-3.1.2.min.js" type="text/javascript"></script>
  
  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>

  <!-- Firebase -->
  <script src='https://cdn.firebase.com/js/client/2.0.2/firebase.js'></script>
  
  <!-- Firechat -->
  <link rel='stylesheet' href='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.css' />
  <script src='https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.js'></script>
  
  <script src="inseme.js"></script>
  
</head>

<body class="grey-text text-darken-4">

  <script type='text/javascript'>
  
    var chatRef;

      function login(provider) {
        chatRef.authWithOAuthPopup(provider, function(error, authData) {
          if (error) {
            console.log(error);
          }
        });
      }
    
    $(document).ready( function(){
      $.embedly.defaults.key = '4b04162cd6134d0da674a15aa65b8c4b';
      // Create a new Firebase reference, and a new instance of the Login client
      chatRef = new Firebase('https://inseme.firebaseio.com/chat');
      chatRef.onAuth(function(authData) {
        // Once authenticated, instantiate Firechat with our user id and user name
        if (authData) {
          var chat = new FirechatUI(chatRef, document.getElementById('firechat-wrapper'));
          Inseme.init( { firechat: chat } );
          chat.setUser(
            authData.uid, 
            authData[authData.provider].displayName
          );
          setTimeout( 
            function(){
              Inseme.login( authData.uid, authData[authData.provider].displayName );
              $vote_buttons = $("#inseme_vote_buttons");
              Inseme.each_choice( function( c ){
                var text = Inseme.config.choices[ c ].text;
                if( !text )return;
                // Add a button to vote according to that choice
                var $input = $(
                  '<a class="inseme_vote_button waves-effect waves-light btn"'
                + ' data-inseme-vote="' + c 
                + '">'
                + text
                + '</a>'
                //  '<input type="button" class="inseme_vote_button" value="' + text
                //
                //+ '" />'
                );
                $input.appendTo( $vote_buttons );
              });
              // Add handler to manage each button
              $(".inseme_vote_button").click ( function() {
                var vote = $(this).attr ( "data-inseme-vote" );
                if( vote === "inseme" ){
                  $("#firechat").find("textarea")
                  .val( "inseme " )
                  .focus();
                  return;
                }
                if( vote === "image" ){
                  $("#firechat").find("textarea")
                  .val( "inseme image http://" )
                  .focus();
                  return;
                }
                Inseme.change_vote( vote );
              } );
            },
            5000
          );
        }
      } );
    } );
    </script>
    
    <div id="inseme_video_container" class="container center">
      <iframe id="inseme_video_frame" src="https://embed.bambuser.com/channel/nuitdebout" width="460" height="345" frameborder="0"></iframe>
    </div>
    
    <div id='firechat-wrapper' class="container">
      <a href='#' onclick='login("twitter");'>Connexion <img src="https://g.twimg.com/dev/sites/default/files/images_documentation/sign-in-with-twitter-gray.png"/></a>
    </div>
    
    <div id='inseme' class="container">
      <span>Proposition : </span><span id="inseme_proposition_text"></span>
      <div>Vous : <span id="inseme_proposition_vote"></span>.
      Ensemble : <span id="inseme_proposition_results"></span></div>
    </div>
    
    <div id='inseme_actions' class="container">
      <div id="inseme_vote_buttons" class="container"></div>
    </div>
    
    <div id='inseme_image_container' class="container">
      <a href="https://pbs.twimg.com/media/CfJGLWBXEAEPBfC.jpg">
      <img src="https://pbs.twimg.com/media/CfJGLWBXEAEPBfC.jpg">
      </a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
    </div>
    
    <footer class="page-footer blue lighten-4"><div class="container">
    <div class="row">
    Inseme
    - <a href="https://github.com/virteal/inseme">&agrave; propos</a>
    - <a href="/pad">pad</a>
    - <a href="http://nuitdebout.fr">nuitdebout.fr</a>
    </div></div></footer>
    
</body>
</html>
